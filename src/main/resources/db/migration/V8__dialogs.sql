CREATE TABLE dialogs
(
    id         INTEGER GENERATED BY DEFAULT AS IDENTITY NOT NULL,
    title      VARCHAR(255),
    is_blocked INTEGER,
    CONSTRAINT pk_dialogs PRIMARY KEY (id)
);

ALTER TABLE messages ADD COLUMN dialog_id INTEGER;

ALTER TABLE messages
    ADD CONSTRAINT FK_MESSAGES_ON_DIALOG FOREIGN KEY (dialog_id) REFERENCES dialogs (id) ON DELETE CASCADE;

CREATE TABLE person2dialog
(
    id         INTEGER GENERATED BY DEFAULT AS IDENTITY NOT NULL,
    person_id  BIGINT,
    dialog_id  INTEGER,
    last_check TIMESTAMP WITHOUT TIME ZONE,
    CONSTRAINT pk_person2dialog PRIMARY KEY (id)
);

ALTER TABLE person2dialog
    ADD CONSTRAINT FK_PERSON2DIALOG_ON_DIALOG FOREIGN KEY (dialog_id) REFERENCES dialogs (id);

ALTER TABLE person2dialog
    ADD CONSTRAINT FK_PERSON2DIALOG_ON_PERSON FOREIGN KEY (person_id) REFERENCES persons (id);